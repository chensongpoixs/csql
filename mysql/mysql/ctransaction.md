###  一, 索引

#### 1, B-Tree 索引的限制

##### ① 如果不是按照索引的最左列开始查找, 则无法使用索引。

##### ② 不能跳过索引中列。

##### ③ 如果查询中有某个列的范围查询，则其右边所有列都无法使用索引优化查找。


#### 2, 哈希索引的限制

##### ① 哈希索引只包含哈希值和行指针, 而不存储字段值, 所有不能使用索引中的值来避免读取行。不过, 访问内存中的行的速度很快, 所以大部分情况下这一点对性能的影响并不明显。

##### ② 哈希索引数据并不是按照索引只顺序存储的, 所以也就无法用于排序。

##### ③ 哈希索引也不支持部分索引列匹配查找， 因为哈希索引始终是使用索引列的全部内容计算哈希值的。

例如：

在数据列(A, B) 上建立哈希索引， 如果查询只有数据列A，则无法使用该索引

##### ④ 哈希索引只支持等值比较查询， 包括=，IN(), <=>(注意<> 和<=>是不同的操作)。也不支持任何范围查询，例如 WHERE price > 100;.

##### ⑤ 访问哈希索引的数据非常快, 除非有很多哈希冲突(不同的索引列值却有相同的哈希值)。当出现哈希冲突的时候，存储引擎必须遍历链表中所有的行指针，逐行进行比较， 直到直到所有符合条件的行。

##### ⑥ 如果哈希冲突很多的话，一些索引维护操作的代价也会很高。

例如:

如果在某个选择性很低(哈希冲突很多)的列上建立哈希索引，那么当从表中删除一行时，存储引擎需要遍历对应哈希值的链表中的每一行，找到并删除对应行的引用，冲突越多，代价越大



md5和sha1都是强加密的， 加密的速度会比较慢， 使用crc64哈希值加密 这个加密速度相比md5和sha1块一点但是会有哈希冲突， 所以在查询的时候要多一个条件 where 


#### 3, 索引的优点

##### ① 索引大大减少了服务器需要扫描的数据量。

##### ② 索引开源帮助服务器避免排序和临时表。

##### ③ 索引开源将随机I/O变为顺序I/O。



### 二, Mysql查询优化

#### 1, Mysql查询流程

![](https://github.com/chensongpoixs/chensongpoixs.github.io/blob/master/img/2019-07-21/mysql_search.png?raw=true)


1. 客户端发送一条查询给服务器。
2. 服务器先检查查询缓存，如果命中了缓存，则立即返回存储中的结果。否则进入下一阶段。
3. 服务器端进入SQL解析，预处理，再由优化器生成对应的执行计划。
4. Mysql根据优化器生成的执行计划，调用存储引擎的API来执行查询。
5. 将结果返回给客户端。



